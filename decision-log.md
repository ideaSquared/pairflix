# üìù AI-managed Decision Log

## Architectural Decisions

| Date       | Decision                                            | Context                                                                                                | Options Considered                                                                                                                                                                                                                                                                                             | Selected Option                                  | Reasoning                                                                                                                                            | Implementation Notes                                                                                                                                                                                                            | Future Considerations                                                                                                                                                                                                  | References                                                                                               |
| ---------- | --------------------------------------------------- | ------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| 2024-01-09 | Migrate to Type-safe DataTable                      | Need to replace existing Table implementations with new type-safe DataTable                            | 1. Keep separate implementations - Low risk but maintains inconsistency<br>2. Gradual migration - Mixed complexity<br>3. Full migration - Higher initial effort but better maintainability                                                                                                                     | Full migration to type-safe DataTable            | 1. Improved type safety across all table implementations<br>2. Standardized table interface across apps<br>3. Better maintainability                 | 1. Update lib.components export<br>2. Migrate UserTables first<br>3. Update activity and system tables                                                                                                                          | 1. Consider adding more advanced features to DataTable<br>2. Monitor performance with large datasets                                                                                                                   | 1. Current Table implementations in app.client and app.admin<br>2. DataTable component in lib.components |
| 2025-06-02 | Docker Build Strategy for Component Library         | Docker builds failing to find @pairflix/components package from npm registry                           | 1. Multi-stage Docker builds - Build components first, then apps<br>2. Shared volumes in Docker Compose - Complex setup<br>3. Npm workspace awareness in Docker - Requires workspace root context                                                                                                              | Multi-stage Docker builds                        | 1. Clean separation of build stages<br>2. Follows Docker best practices<br>3. Reproducible builds without external registry dependencies             | 1. Created multi-stage Dockerfiles for app.client and app.admin<br>2. First stage builds the component library<br>3. Second stage copies built components and installs app dependencies                                         | 1. Consider publishing components to private npm registry<br>2. Evaluate build time impact<br>3. Implement caching strategies for component builds                                                                     | 1. Docker multi-stage builds<br>2. Monorepo dependency management                                        |
| 2025-06-02 | DataTable Direct Path Import Strategy               | Need to import DataTable from lib.components into app.client and app.admin                             | 1. Use @pairflix/components package name - Standard but requires package config<br>2. Set up path aliases - Clean imports but needs config<br>3. Use direct relative path imports - Works immediately without config                                                                                           | Direct relative path imports                     | 1. Immediate solution without config changes<br>2. Works in both apps consistently<br>3. Clear dependency tracking                                   | 1. Import DataTable directly from lib.components/src/components/common/Table<br>2. Update UserTable implementations to use type-safe DataTable<br>3. Define columns with proper generic typing                                  | 1. Consider setting up proper package aliases<br>2. May need to optimize bundle size<br>3. Monitor TypeScript path resolution issues                                                                                   | 1. TypeScript module resolution<br>2. Direct file imports in monorepo structures                         |
| 2025-06-02 | Table Component Migration Completion                | Need to ensure all table implementations are migrated to type-safe DataTable                           | 1. Only migrate UserTable components - Partial implementation<br>2. Migrate all table implementations - Complete solution<br>3. Create hybrid approach with adapter components                                                                                                                                 | Complete migration of all table components       | 1. Consistent type safety across all tables<br>2. Standardized interface improves maintainability<br>3. Better developer experience                  | 1. Updated UserTable in both app.client and app.admin<br>2. Migrated UserManagementContent to use DataTable<br>3. Defined type-safe column configurations for all tables                                                        | 1. Consider creating adapters for special table use cases<br>2. Add documentation for DataTable usage<br>3. Develop reusable column definitions                                                                        | 1. Type-safe component patterns<br>2. Consistent UI implementation                                       |
| 2025-06-02 | Partial Migration Handling                          | Found partially migrated components with incorrect DataTable implementation                            | 1. Fix issues directly - Quick but incomplete<br>2. Document issues in migration guide - Better for team knowledge<br>3. Create formal fix patterns - Most comprehensive                                                                                                                                       | Document issues and create standardized patterns | 1. Ensures consistency across all migrations<br>2. Creates shared knowledge for the team<br>3. Provides clear guidelines for remaining work          | 1. Updated migration guide with proper column definitions<br>2. Documented common migration issues<br>3. Created examples of correct type usage for render functions                                                            | 1. Consider creating TypeScript utility types for column definitions<br>2. Add automated tests for correct DataTable usage<br>3. Create ESLint rules for DataTable props                                               | 1. TypeScript function parameter types<br>2. React component prop patterns                               |
| 2025-06-02 | Multi-Table Component Strategy                      | Components with multiple tables requiring migration (e.g., SystemStatsContent)                         | 1. Define table data types globally - Simple but may cause issues<br>2. Define types inline - Quick but harder to maintain<br>3. Create dedicated types and column definitions - Most maintainable                                                                                                             | Create dedicated types and column definitions    | 1. Better type safety with specific types<br>2. Improved readability with clear organization<br>3. Easier maintenance with separated concerns        | 1. Define dedicated interfaces for each table data structure<br>2. Create separate column definitions<br>3. Implement small DataTable instances with specific props                                                             | 1. Consider extracting common column patterns<br>2. Create reusable formatting functions<br>3. Add prop comments for documentation                                                                                     | 1. React component composition<br>2. TypeScript interface segregation                                    |
| 2025-06-02 | DataTable Completion Strategy                       | Complete the remaining DataTable component migrations                                                  | 1. Complete each component one at a time - Methodical<br>2. Focus only on broken components - Quick fix<br>3. Use common patterns across all components - Systematic                                                                                                                                           | Complete each component with consistent patterns | 1. Ensures type safety across all components<br>2. Standardizes approach for all tables<br>3. Improves maintainability                               | 1. Fixed ContentModerationContent import issues<br>2. Implemented proper typed columns in UserActivityContent<br>3. Added action handlers with proper typing in AuditLogContent                                                 | 1. Consider creating utility functions for common column rendering<br>2. Extract shared column patterns to reusable definitions<br>3. Add validation tests for DataTable implementation                                | 1. TypeScript generic component patterns<br>2. React component prop typing best practices                |
| 2025-06-02 | Path Alias Implementation for Component Library     | Need consistent and maintainable imports from lib.components                                           | 1. Direct file path imports - Brittle and error-prone<br>2. Package-level path aliases - Clean but needs configuration<br>3. Npm linking - Standard but complex setup                                                                                                                                          | Package-level path aliases via tsconfig and vite | 1. Single import source of truth<br>2. Better IDE autocompletion<br>3. Cleaner, more maintainable imports                                            | 1. Updated tsconfig.json with path aliases in both app.client and app.admin<br>2. Updated vite.config.ts in both projects for alias resolution<br>3. Refactored imports to use @lib.components across projects                  | 1. Consider publishing lib.components as an actual npm package<br>2. Implement versioning for the component library<br>3. Set up automated dependency updates                                                          | 1. TypeScript path mapping<br>2. Monorepo component sharing patterns                                     |
| 2025-06-02 | ContentModerationContent Component Typing           | Fixed TypeScript errors in admin content moderation                                                    | 1. Use any types - Quick but unsafe<br>2. Partial type implementation - Mixed safety<br>3. Full TypeScript implementation - Most maintainable                                                                                                                                                                  | Full TypeScript implementation                   | 1. Complete type safety<br>2. Better maintainability<br>3. Improved developer experience                                                             | 1. Added proper interfaces for ContentItem and ReportItem<br>2. Fixed event handler types<br>3. Added proper typing for styled components                                                                                       | 1. Consider extracting common type patterns<br>2. Add unit tests for type coverage<br>3. Create reusable type utilities                                                                                                | 1. TypeScript best practices<br>2. React event handling patterns                                         |
| 2025-06-02 | Component Library Standardization                   | Inconsistent component usage across apps with duplicated components                                    | 1. Keep separate implementations - Allows app-specific customization<br>2. Use shared components with local overrides - Hybrid approach<br>3. Fully standardize on lib.components - Most consistent                                                                                                            | Fully standardize on lib.components              | 1. Eliminates code duplication<br>2. Ensures consistent UI across applications<br>3. Centralizes component maintenance                               | 1. Add @pairflix/components dependency to all apps<br>2. Update imports to use the shared library<br>3. Remove duplicated components while keeping app-specific ones                                                            | 1. Consider creating documentation for component usage<br>2. Set up versioning strategy for the component library<br>3. Add visual regression testing                                                                  | 1. React component libraries<br>2. Monorepo dependency management                                        |
| 2025-06-02 | File System-based Component Migration               | Migration script faced path resolution issues on Windows                                               | 1. Fix path handling in grep-based script - Complex and error-prone<br>2. Use direct file system traversal - More reliable<br>3. Use a third-party codemod tool - More complex setup                                                                                                                           | Direct file system traversal approach            | 1. Platform independent solution<br>2. More reliable without shell command dependencies<br>3. Better error handling                                  | 1. Created migrate-components-fixed.js script<br>2. Used fs.readFileSync for direct file access<br>3. Implemented recursive directory traversal for finding component imports                                                   | 1. Consider moving to a proper codemod solution<br>2. Add automated tests for migration scripts<br>3. Create a validation tool to detect duplicated components                                                         | 1. Node.js file system API<br>2. Cross-platform JS development                                           |
| 2025-06-02 | Create Shared Layout Component in Component Library | Need for a standardized Layout component in the shared library instead of app-specific implementations | 1. Keep using app-specific Layout components - Maintains app customization but duplicates code<br>2. Move entire app-specific Layout to shared library - Not feasible due to app-specific dependencies<br>3. Create a simplified shared Layout in the library - Clean separation while maintaining flexibility | Create simplified shared Layout component        | 1. Allows standardized layout patterns across applications<br>2. Maintains separation between shared UI and app logic<br>3. Reduces code duplication | 1. Created basic PageLayout component in lib.components/src/components/layout<br>2. Exported it as Layout from the shared library<br>3. Updated import in WatchlistPage.tsx to use shared component                             | 1. Consider expanding shared Layout with customizable regions<br>2. Add theme context integration<br>3. Create variants for different layout patterns                                                                  | 1. Component library best practices<br>2. UI composition patterns                                        |
| 2025-06-02 | Fix Docker Build for Local Component Dependencies   | Docker builds failing with npm errors when trying to resolve @pairflix/components package              | 1. Use symlinks in Docker - Can lead to permission issues<br>2. Use npm workspaces - Would require project restructuring<br>3. Use package bypass approach - Remove dependency temporarily during install<br>4. Use local npm registry - More complex setup                                                    | Package bypass approach with multi-stage builds  | 1. Avoids npm resolution issues entirely<br>2. Works with standard npm<br>3. Preserves original package.json                                         | 1. Used grep to create temporary package.json without the local dependency<br>2. Installed only npm registry dependencies<br>3. Manually copied built component files into node_modules<br>4. Restored original package.json    | 1. Consider implementing npm workspaces in the future<br>2. Evaluate publishing components to a private registry<br>3. Add caching strategies for faster builds                                                        | 1. Docker multi-stage builds<br>2. npm dependency management<br>3. Monorepo strategies                   |
| 2025-06-02 | Remove Duplicated UI Components from App Folders    | Duplicated UI components exist in both app.admin/client and lib.components                             | 1. Keep all duplicated components - No risk but increases maintenance<br>2. Remove app duplicates and import from library - Reduces duplication but requires import updates<br>3. Move all components to apps - Increases duplication                                                                          | Remove duplicates and import from library        | 1. Reduces code duplication<br>2. Centralizes UI component maintenance<br>3. Promotes consistent UI across applications                              | 1. Updated imports in app files to use @pairflix/components<br>2. Deleted duplicated basic UI components (Button, Card, etc.)<br>3. Kept app-specific components (SessionManager, QueryErrorBoundary, etc.)                     | 1. Create migration guide for additional components<br>2. Consider automating duplicate detection<br>3. Implement visual regression tests to ensure UI consistency                                                     | 1. Component library best practices<br>2. Code duplication reduction strategies                          |
| 2025-06-02 | Global Navigation Bar Implementation in app.client  | Navbar wasn't visible in some pages of app.client due to inconsistent use of Layout components         | 1. Add Header to each page component - Duplicates code<br>2. Use Layout wrapper for each route - Clean but requires route changes<br>3. Add Header directly in App.tsx - Can cause duplicate navbars                                                                                                           | Use consistent local Layout wrapper              | 1. Ensures consistent navigation<br>2. Follows existing application design pattern<br>3. Avoids duplicate navbars                                    | 1. Modified ActivityPage to use local Layout component<br>2. Fixed WatchlistPage to use local Layout instead of simplified @pairflix/components Layout<br>3. Fixed import confusion between local and library Layout components | 1. Consider implementing a more comprehensive layout system<br>2. Create routing structure that ensures layouts are consistently applied<br>3. Rename components to avoid confusion between local and library versions | 1. React component composition<br>2. Application layout patterns<br>3. Component naming conventions      |
| 2025-06-02 | Admin Authentication Flow Fix | Admin app was getting stuck at "Checking authentication..." after login | 1. Use AdminAuthContext - Complete redesign<br>2. Fix useAuth authentication flow - Targeted fix<br>3. Use different authentication pattern - Complete redesign | Fix useAuth authentication flow | 1. Minimizes changes to existing code<br>2. Addresses specific issue directly<br>3. Preserves current authentication pattern | 1. Enhanced token validation error handling<br>2. Fixed login redirect flow and timing<br>3. Improved error reporting and debugging<br>4. Added proper try-catch blocks in auth flow | 1. Consider implementing a more robust auth provider pattern<br>2. Add refresh token functionality<br>3. Improve error state handling in login form | 1. React authentication patterns<br>2. JWT authentication best practices |
| 2025-06-02 | Standardize Admin Authentication Token Key          | Authentication token storage was inconsistent across admin app, causing "No token provided" errors     | 1. Use plain 'token' key - Simple but ambiguous<br>2. Use env variable for key - Configurable but complex<br>3. Use constant 'admin_token' key - Clear purpose and consistent                                                                                                                                  | Use constant ADMIN_TOKEN_KEY                     | 1. Clear distinction from other tokens<br>2. Consistent across all admin components<br>3. Easy to maintain and update                                | 1. Created ADMIN_TOKEN_KEY constant in api/utils.ts<br>2. Updated all token storage/retrieval to use constant<br>3. Modified login, auth hooks, and API utilities for consistency                                              | 1. Consider implementing token rotation<br>2. Add token validation checks<br>3. Consider encrypting token in localStorage                                                                                                | 1. JWT best practices<br>2. React authentication patterns                                                |
| 2025-06-02 | Optimize Admin Settings Loading                     | Settings API calls were triggering before authentication was confirmed, causing unnecessary 401 errors | 1. Keep current behavior - Simple but causes errors<br>2. Load settings in AdminRoute - Could cause delay<br>3. Modify SettingsProvider to respect auth state - Clean solution                                                                                                                                  | Modify SettingsProvider for auth-aware loading    | 1. Prevents unnecessary API calls<br>2. Better user experience<br>3. Reduces server load from unauthorized requests                                   | 1. Added auth check in SettingsProvider<br>2. Moved initial loading state to false<br>3. Reset settings on deauthentication                                                                                                    | 1. Consider caching strategy for settings<br>2. Add error retry logic<br>3. Implement optimistic updates for settings changes                                                                                           | 1. React Context patterns<br>2. Auth-aware data loading                                                  |

## Trade-offs

| Date       | Decision                       | Context                                            | Options Considered                                                                                                             | Selected Option                         | Reasoning                                                                                               | Implementation Notes                                                                                                                                                              | Future Considerations                                                                                                                        | References                                          |
| ---------- | ------------------------------ | -------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------- | ------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| 2025-05-27 | API Integration                | Need external movie/TV data source                 | 1. TMDb API<br>2. OMDB API<br>3. Custom database                                                                               | TMDb API                                | 1. Rich metadata<br>2. Simple integration<br>3. Active maintenance                                      | 1. Created tmdb.service.ts<br>2. Implemented caching layer                                                                                                                        | 1. Monitor rate limits<br>2. Consider fallback sources                                                                                       | TMDb API documentation                              |
| 2025-05-27 | User Management                | User account approach for small app                | 1. Full registration flow<br>2. OAuth providers<br>3. Manual setup                                                             | Manual user setup                       | 1. Simpler for two-user app<br>2. Less security overhead<br>3. Faster implementation                    | 1. Added admin-only user creation<br>2. Simplified onboarding                                                                                                                     | 1. May need to expand if user base grows<br>2. Consider adding self-registration later                                                       | User management patterns                            |
| 2025-05-27 | Data Architecture              | Database schema design approach                    | 1. NoSQL document approach<br>2. Normalized relational<br>3. Hybrid approach                                                   | Normalized database schema              | 1. Data integrity is priority<br>2. Relationships are well-defined<br>3. Query patterns are predictable | 1. Created related models<br>2. Defined foreign key constraints<br>3. Set up model associations                                                                                   | 1. May need denormalization for performance<br>2. Consider view materialization for complex queries                                          | Database design patterns                            |
| 2025-05-27 | Feature Scope                  | Initial feature priorities                         | 1. All features at once<br>2. Core matching only<br>3. Phased approach                                                         | Core matching functionality first       | 1. Delivers core value faster<br>2. Allows feedback on core experience<br>3. Reduces initial complexity | 1. Implemented matching algorithm<br>2. Built watchlist management<br>3. Created basic UI                                                                                         | 1. Plan for activity feed in phase 2<br>2. Consider recommendation engine later                                                              | Agile development practices                         |
| 2025-05-27 | Recommendation Algorithm       | Content suggestion approach                        | 1. Collaborative filtering - Complex<br>2. Simple matching - Basic<br>3. Hybrid system                                         | Simple similarity-based recommendations | 1. Easier to explain to users<br>2. Simpler implementation<br>3. Good enough for initial version        | 1. Created recommendation service<br>2. Built Recommendations component<br>3. Added to MatchPage                                                                                  | 1. Consider machine learning approach for V2<br>2. Add user feedback mechanisms<br>3. A/B test                                               | Content recommendation patterns                     |
| 2025-05-27 | Component Framework Selection  | UI component encapsulation approach                | 1. CSS Modules - Scoped CSS<br>2. Tailwind - Utility CSS<br>3. Styled-components - CSS-in-JS                                   | Styled-components                       | 1. Component encapsulation<br>2. Theme support<br>3. Dynamic styling based on props                     | 1. Enhanced responsive styling<br>2. Used theme variables<br>3. Added media queries                                                                                               | 1. Monitor bundle size<br>2. Consider extraction optimization<br>3. Keep dependencies updated                                                | CSS-in-JS documentation<br>Styled-components docs   |
| 2025-05-27 | Mobile Responsiveness Strategy | Adapting UI to various screen sizes                | 1. Mobile-first - Start small<br>2. Desktop-first - Adapt down<br>3. Separate versions                                         | Mobile-first responsive design          | 1. Better performance on mobile<br>2. Progressive enhancement<br>3. Single codebase maintenance         | 1. Added responsive media queries<br>2. Enhanced touch targets<br>3. Simplified layouts                                                                                           | 1. Consider device-specific optimizations<br>2. Test on various devices<br>3. Monitor analytics                                              | Responsive design best practices<br>Mobile patterns |
| 2025-05-28 | API Integration Type Fix       | TypeScript error when accessing admin API settings | 1. Import admin API directly from admin.ts<br>2. Fix index.ts to properly export admin module<br>3. Create separate API client | Fix both import and index exports       | 1. Maintains project structure<br>2. Ensures type safety<br>3. Follows proper module usage patterns     | 1. Updated app.client/src/services/api/index.ts to export admin module<br>2. Fixed SettingsContext.tsx import to use correct named import<br>3. Updated mapping of admin settings | 1. Consider creating shared types between admin/client<br>2. Evaluate caching strategy for settings<br>3. Add tests for settings integration | TypeScript module documentation                     |

## Uncertainty Notes

| Date       | Uncertainty Area                  | Confidence Level | Description                                                        | Mitigation Strategy                                                                      |
| ---------- | --------------------------------- | ---------------- | ------------------------------------------------------------------ | ---------------------------------------------------------------------------------------- |
| 2025-05-27 | TMDb API Reliability              | Medium           | External API dependency may change or have downtime                | 1. Implement caching<br>2. Create fallback mechanisms<br>3. Monitor API status           |
| 2025-05-27 | Performance with Large Watchlists | Medium           | Match algorithm efficiency may decrease with very large watchlists | 1. Implement pagination<br>2. Optimize database queries<br>3. Add results caching        |
| 2025-05-27 | User Experience Design            | High             | Simple two-user model reduces complexity                           | 1. Conduct user testing<br>2. Gather feedback regularly<br>3. Iterate on UX issues       |
| 2025-05-27 | Security Model                    | High             | JWT implementation follows best practices                          | 1. Regular security audits<br>2. Keep dependencies updated<br>3. Follow OWASP guidelines |
| 2025-05-27 | Tag System User Adoption          | Medium           | Users may not consistently use tags                                | 1. Add tag suggestions<br>2. Display tag benefits<br>3. Create guided onboarding         |
| 2025-05-27 | Recommendation Quality            | Medium           | Simple algorithm may not provide ideal suggestions                 | 1. Gather user feedback<br>2. Monitor engagement metrics<br>3. Iterate on algorithm      |
